<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student Progress Check</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4;--success:#22c55e;--danger:#ef4444}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; margin:0; background:linear-gradient(180deg,#071022 0%, #071a2a 100%); color:#e6eef6; padding:28px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{margin:0;font-size:20px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.04); padding:16px;border-radius:12px; box-shadow: 0 6px 20px rgba(2,6,23,0.6)}

    .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
    form .row{display:flex;gap:8px;margin-bottom:8px}
    label{font-size:12px;color:var(--muted)}
    input[type=text],select,input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:#042a2f;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03);font-size:14px}
    th{font-size:12px;color:var(--muted)}

    .small{font-size:12px;color:var(--muted)}
    .progress{height:12px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#3b82f6);}
    .actions{display:flex;gap:6px}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:880px){.grid{grid-template-columns:1fr;}.container{padding:12px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Student Progress Check</h1>
        <div class="small">Add students, subjects & marks — see averages, progress and export data.</div>
      </div>
      <div>
        <button id="exportBtn">Export CSV</button>
        <button id="clearStorage" class="ghost">Reset</button>
      </div>
    </header>

    <div class="grid">
      <section class="card" id="left">
        <h3 style="margin-top:0">Students</h3>
        <div class="small">Filter / search students by name or subject</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="searchInput" placeholder="Search by name or subject..." />
          <select id="sortSelect">
            <option value="name">Sort: Name</option>
            <option value="avg-desc">Sort: Average (high→low)</option>
            <option value="avg-asc">Sort: Average (low→high)</option>
          </select>
        </div>

        <div id="tableWrap" style="margin-top:12px">
          <table id="studentsTable" class="card">
            <thead>
              <tr><th>Name</th><th>Subjects</th><th>Average</th><th>Status</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <aside class="card" id="right">
        <h3 style="margin-top:0">Add / Edit Student</h3>
        <form id="studentForm">
          <div class="row">
            <div style="flex:1">
              <label>Name</label>
              <input type="text" id="studentName" required />
            </div>
            <div style="width:110px">
              <label>Class</label>
              <input type="text" id="studentClass" placeholder="10A" />
            </div>
          </div>

          <div id="subjectsArea">
            <label class="small">Subjects & Marks</label>
            <div id="subjectsList"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <input type="text" id="newSubName" placeholder="Subject name" />
              <input type="number" id="newSubMark" placeholder="Marks (0-100)" min="0" max="100" />
              <button id="addSubjectBtn" type="button">Add</button>
            </div>
          </div>

          <div style="display:flex;gap:8px;margin-top:12px">
            <button id="saveBtn">Save Student</button>
            <button id="cancelEdit" type="button" class="ghost">Cancel</button>
          </div>

          <input type="hidden" id="editingId" />
        </form>

        <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />
        <h4>Details</h4>
        <div id="detailPanel" class="small">Click a student to see details & subject breakdown.</div>
      </aside>
    </div>

    <footer class="small">Built with ❤️ — let me know if you want printing, PDF export or charts.</footer>
  </div>

  <script>
    // Simple single-file student progress app (vanilla JS)
    // Features: add/edit/delete students, add subjects, compute averages, sort/search, localStorage persistence, export CSV

    const STORAGE_KEY = 'student_progress_data_v1';
    let students = [];

    // Elements
    const tbody = document.querySelector('#studentsTable tbody');
    const studentForm = document.getElementById('studentForm');
    const studentName = document.getElementById('studentName');
    const studentClass = document.getElementById('studentClass');
    const subjectsList = document.getElementById('subjectsList');
    const newSubName = document.getElementById('newSubName');
    const newSubMark = document.getElementById('newSubMark');
    const addSubjectBtn = document.getElementById('addSubjectBtn');
    const saveBtn = document.getElementById('saveBtn');
    const cancelEdit = document.getElementById('cancelEdit');
    const editingId = document.getElementById('editingId');
    const detailPanel = document.getElementById('detailPanel');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const exportBtn = document.getElementById('exportBtn');
    const clearStorage = document.getElementById('clearStorage');

    // util
    function uid(){return 'id_' + Math.random().toString(36).slice(2,9)}
    function load(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw) students = JSON.parse(raw);
        else {
          // sample data
          students = [
            {id:uid(), name:'Aisha Kumar', class:'10A', subjects:[{name:'Math',mark:88},{name:'Science',mark:76},{name:'English',mark:82}]},
            {id:uid(), name:'Rohit Singh', class:'10B', subjects:[{name:'Math',mark:58},{name:'Science',mark:62},{name:'English',mark:55}]},
            {id:uid(), name:'Meera Patel', class:'10A', subjects:[{name:'Math',mark:95},{name:'Science',mark:91},{name:'English',mark:89}]}
          ];
          save();
        }
      } catch(e){console.error(e);students=[]}
    }
    function save(){localStorage.setItem(STORAGE_KEY, JSON.stringify(students))}

    function computeAverage(subjects){
      if(!subjects || subjects.length===0) return 0;
      const sum = subjects.reduce((s,x)=>s + (Number(x.mark)||0),0);
      return Math.round((sum/subjects.length)*100)/100;
    }

    function gradeFromAvg(avg){
      if(avg>=90) return 'A+';
      if(avg>=80) return 'A';
      if(avg>=70) return 'B';
      if(avg>=60) return 'C';
      if(avg>=50) return 'D';
      return 'F';
    }

    function render(){
      tbody.innerHTML='';
      const q = (searchInput.value||'').toLowerCase();
      let list = students.slice();
      // Apply search
      if(q){
        list = list.filter(s=> s.name.toLowerCase().includes(q) || s.class?.toLowerCase().includes(q) || s.subjects.some(sub=>sub.name.toLowerCase().includes(q)));
      }
      // Sort
      const sort = sortSelect.value;
      if(sort==='name') list.sort((a,b)=>a.name.localeCompare(b.name));
      if(sort==='avg-desc') list.sort((a,b)=> computeAverage(b.subjects) - computeAverage(a.subjects));
      if(sort==='avg-asc') list.sort((a,b)=> computeAverage(a.subjects) - computeAverage(b.subjects));

      list.forEach(s=>{
        const avg = computeAverage(s.subjects);
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><div style="font-weight:600">${escapeHtml(s.name)}</div><div class="small">${escapeHtml(s.class||'')}</div></td>
          <td>${s.subjects.map(sub=>`<div class="pill">${escapeHtml(sub.name)}: ${sub.mark}</div>`).join(' ')}</td>
          <td>
            <div style="width:120px">
              <div class="small">${avg}%</div>
              <div class="progress" title="${avg}%"><i style="width:${Math.max(3,Math.min(100,avg))}%"></i></div>
            </div>
          </td>
          <td>${gradeFromAvg(avg)}</td>
          <td class="actions">
            <button data-id="${s.id}" class="viewBtn ghost">View</button>
            <button data-id="${s.id}" class="editBtn">Edit</button>
            <button data-id="${s.id}" class="delBtn" style="background:var(--danger);color:white">Delete</button>
          </td>
        `;
        tbody.appendChild(tr);
      });

      attachRowListeners();
    }

    function attachRowListeners(){
      document.querySelectorAll('.viewBtn').forEach(b=>b.onclick = ()=> showDetail(b.dataset.id));
      document.querySelectorAll('.editBtn').forEach(b=>b.onclick = ()=> startEdit(b.dataset.id));
      document.querySelectorAll('.delBtn').forEach(b=>b.onclick = ()=> deleteStudent(b.dataset.id));
    }

    function showDetail(id){
      const s = students.find(x=>x.id===id);
      if(!s) return;
      const avg = computeAverage(s.subjects);
      detailPanel.innerHTML = `
        <div style="font-weight:700">${escapeHtml(s.name)} <span class=\"small\">${escapeHtml(s.class||'')}</span></div>
        <div class=\"small\">Average: ${avg}% — Grade: ${gradeFromAvg(avg)}</div>
        <div style=\"margin-top:8px\">${s.subjects.map(sub=>`<div><strong>${escapeHtml(sub.name)}:</strong> ${sub.mark}</div>`).join('')}</div>
      `;
    }

    function startEdit(id){
      const s = students.find(x=>x.id===id);
      if(!s) return;
      editingId.value = s.id;
      studentName.value = s.name;
      studentClass.value = s.class||'';
      renderSubjectsEditor(s.subjects);
    }

    function deleteStudent(id){
      if(!confirm('Delete this student?')) return;
      students = students.filter(x=>x.id!==id);
      save(); render();
    }

    function renderSubjectsEditor(subjects){
      subjectsList.innerHTML='';
      (subjects||[]).forEach((sub,idx)=>{
        const div = document.createElement('div');
        div.style.display='flex'; div.style.gap='8px'; div.style.marginTop='6px';
        div.innerHTML = `
          <input data-idx="${idx}" class="subName" value="${escapeAttr(sub.name)}" />
          <input data-idx="${idx}" type="number" class="subMark" value="${sub.mark}" min="0" max="100" style="width:96px" />
          <button data-idx="${idx}" class="removeSub ghost">Remove</button>
        `;
        subjectsList.appendChild(div);
      });
      // bind remove
      subjectsList.querySelectorAll('.removeSub').forEach(b=>b.onclick = ()=>{
        const i = Number(b.dataset.idx);
        subjects.splice(i,1);
        renderSubjectsEditor(subjects);
      });
    }

    addSubjectBtn.onclick = ()=>{
      const name = newSubName.value.trim();
      const mark = Number(newSubMark.value);
      if(!name || isNaN(mark)) return alert('Enter subject and numeric mark');
      // get current array
      let subs = [];
      const id = editingId.value;
      if(id){
        const s = students.find(x=>x.id===id);
        subs = s.subjects;
      } else {
        // when adding new student, render a temporary list in form state
        if(!studentForm.__tmpSubjects) studentForm.__tmpSubjects = [];
        subs = studentForm.__tmpSubjects;
      }
      subs.push({name, mark});
      newSubName.value=''; newSubMark.value='';
      if(id) renderSubjectsEditor(subs); else renderSubjectsEditor(subs);
    }

    // Save form
    studentForm.onsubmit = (e)=>{
      e.preventDefault();
      const name = studentName.value.trim();
      if(!name) return alert('Enter student name');
      const cls = studentClass.value.trim();
      const id = editingId.value;
      let subjects = [];
      // If editing, read current fields from subjectsList inputs
      if(id){
        const s = students.find(x=>x.id===id);
        subjects = Array.from(subjectsList.querySelectorAll('.subName')).map((el,i)=>({name:el.value, mark: Number(subjectsList.querySelectorAll('.subMark')[i].value)||0}));
      } else {
        subjects = (studentForm.__tmpSubjects || []).slice();
      }

      if(id){
        // update
        const s = students.find(x=>x.id===id);
        s.name = name; s.class = cls; s.subjects = subjects;
      } else {
        students.push({id:uid(), name, class:cls, subjects});
      }
      // clear
      studentForm.reset(); studentForm.__tmpSubjects = []; editingId.value=''; subjectsList.innerHTML='';
      save(); render();
    }

    cancelEdit.onclick = ()=>{ studentForm.reset(); studentForm.__tmpSubjects = []; editingId.value=''; subjectsList.innerHTML=''; }

    // Make subjects editor reactive for new-student flow
    function renderSubjectsEditor(subjects){
      // If called with no array and not editing, use tmp
      if(!subjects){
        subjects = studentForm.__tmpSubjects || [];
      }
      studentForm.__tmpSubjects = subjects;
      subjectsList.innerHTML='';
      subjects.forEach((sub,idx)=>{
        const div = document.createElement('div');
        div.style.display='flex'; div.style.gap='8px'; div.style.marginTop='6px';
        div.innerHTML = `
          <input data-idx="${idx}" class="subName" value="${escapeAttr(sub.name)}" />
          <input data-idx="${idx}" type="number" class="subMark" value="${sub.mark}" min="0" max="100" style="width:96px" />
          <button data-idx="${idx}" class="removeSub ghost">Remove</button>
        `;
        subjectsList.appendChild(div);
      });
      subjectsList.querySelectorAll('.removeSub').forEach(b=>b.onclick = ()=>{
        const i = Number(b.dataset.idx);
        studentForm.__tmpSubjects.splice(i,1);
        renderSubjectsEditor(studentForm.__tmpSubjects);
      });
    }

    // Helpers
    function escapeHtml(s){return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}
    function escapeAttr(s){return String(s).replaceAll('"','&quot;').replaceAll("'","&#39;")}

    // Search / sort listeners
    searchInput.oninput = render; sortSelect.onchange = render;

    // Export CSV
    exportBtn.onclick = ()=>{
      const rows = [['Name','Class','Subject','Marks']];
      students.forEach(s=> s.subjects.forEach(sub=> rows.push([s.name, s.class||'', sub.name, sub.mark])));
      const csv = rows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n');
      const blob = new Blob([csv], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='students.csv'; a.click(); URL.revokeObjectURL(url);
    }

    clearStorage.onclick = ()=>{ if(confirm('Clear all data and reset sample?')){ localStorage.removeItem(STORAGE_KEY); load(); render(); }}

    // Init
    load(); render();
  </script>
</body>
</html>
